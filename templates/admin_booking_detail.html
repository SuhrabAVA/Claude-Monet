{% extends "base_admin.html" %}
{% block title %}Админ — Бронь #{{ reservation.id }}{% endblock %}

{% block content %}
<div class="admin-container">
  <div class="admin-header">
    <div>
      <h1 class="admin-title">Бронь #{{ reservation.id }}</h1>
      <p class="admin-sub">Вся информация о госте сверху, заказ и итог — ниже.</p>
    </div>
    <div class="admin-actions">
      <a class="btn" href="{{ url_for('admin_bookings') }}">← К списку</a>
      <a class="btn btn--gold" href="{{ url_for('admin_menu_new', tab='item') }}">＋ Добавить меню</a>
    </div>
  </div>

  <div class="admin-grid">
    <div class="admin-split">
      <div class="admin-card">
        <div class="admin-card__hd">
          <div class="admin-card__title">Данные брони</div>
          <span class="badge">Гостей: {{ reservation.guests }}</span>
        </div>
        <div class="admin-card__bd">
          <div class="form-grid">
            <div>
              <div class="small">Имя</div>
              <div style="font-weight:800; font-size:16px; margin-top:4px;">{{ reservation.full_name }}</div>
            </div>
            <div>
              <div class="small">Почта</div>
              <div style="font-weight:700; margin-top:4px;">{{ reservation.email or '—' }}</div>
            </div>

            <div>
              <div class="small">Телефон</div>
              <div style="font-weight:700; margin-top:4px;">{{ reservation.phone or '—' }}</div>
            </div>
            <div>
              <div class="small">Создано</div>
              <div style="font-weight:700; margin-top:4px;">{{ reservation.created_at }}</div>
            </div>

            <div>
              <div class="small">Дата</div>
              <div style="font-weight:800; margin-top:4px;">{{ reservation.date }}</div>
            </div>
            <div>
              <div class="small">Время</div>
              <div style="font-weight:800; margin-top:4px;">{{ reservation.time }}</div>
            </div>

            <div class="span2">
              <div class="hr"></div>
              <div class="small">Особые пожелания</div>
              <div style="margin-top:6px; line-height:1.5;">{{ reservation.notes or '—' }}</div>
            </div>
          </div>
        </div>
      </div>

      <div class="admin-card">
        <div class="admin-card__hd">
          <div class="admin-card__title">Итог</div>
          <span class="badge badge--gold">{{ money(reservation.total_cents) }}</span>
        </div>
        <div class="admin-card__bd">
          <div class="small">Позиции</div>
          <div style="font-weight:900; font-size:26px; margin-top:6px;">{{ items|length }}</div>
          <div class="hr"></div>
          <div class="small">Если сумма = ₸0, значит бронировали стол без заказа блюд.</div>
        </div>
      </div>
    </div>

    <div class="admin-card">
      <div class="admin-card__hd">
        <div class="admin-card__title">Заказ</div>
        <div class="small">Итог: <span style="color:var(--gold2); font-weight:800;">{{ money(reservation.total_cents) }}</span></div>
      </div>
      <div class="admin-card__bd">
        {% if items %}
          <div class="table-wrap">
            <table class="admin-table" style="min-width:760px;">
              <thead>
                <tr>
                  <th>Блюдо</th>
                  <th style="width:90px;">Кол-во</th>
                  <th style="width:140px;">Цена</th>
                  <th style="width:140px;">Сумма</th>
                </tr>
              </thead>
              <tbody>
                {% for it in items %}
                  <tr>
                    <td>
                      <div style="display:flex; gap:12px; align-items:center;">
                        <div style="width:56px; height:56px; border-radius:14px; overflow:hidden; border:1px solid rgba(255,255,255,.08); background:rgba(0,0,0,.15);">
                          <img src="{{ url_for('static', filename=it.image_path) }}" alt="{{ it.title }}" style="width:100%; height:100%; object-fit:cover;">
                        </div>
                        <div>
                          <div style="font-weight:900;">{{ it.title }}</div>
                          <div class="small">{{ money(it.unit_price_cents) }} за порцию</div>
                        </div>
                      </div>
                    </td>
                    <td><span class="badge">{{ it.qty }}</span></td>
                    <td><span class="badge badge--gold">{{ money(it.unit_price_cents) }}</span></td>
                    <td><span class="badge badge--gold">{{ money(it.line_total_cents) }}</span></td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="small">Нет позиций в заказе.</div>
        {% endif %}
      </div>
    </div>

  </div>
</div>
{% endblock %}
